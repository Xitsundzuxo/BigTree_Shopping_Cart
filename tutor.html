<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tutorials - BigTree Shopping Cart</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    
    .module-expanded {
      max-height: 2000px;
      transition: max-height 0.5s ease-in-out;
    }
    
    .module-collapsed {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-in-out;
    }
    
    .tutorial-step {
      counter-increment: step;
    }
    
    .tutorial-step:before {
      content: counter(step);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      border-radius: 50%;
      margin-right: 12px;
      font-size: 14px;
      font-weight: bold;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease;
    }
    
    /* Admin specific styles */
    .admin-badge {
      position: relative;
    }
    
    .admin-badge:after {
      content: "ADMIN";
      position: absolute;
      top: -8px;
      right: -8px;
      background: #ef4444;
      color: white;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-black min-h-screen text-white">

<header class="flex items-center justify-between px-6 py-4 sticky top-0 bg-gray-900/90 backdrop-blur-md z-50 border-b border-gray-800">
  <div class="flex items-center space-x-3">
    <div class="flex items-center space-x-2">
      <img src="BigTree_logo.png" class="w-8 h-8" alt="App Logo">
    </div>
    <div>
      <span class="font-bold text-xl">BigTree Shopping Cart</span>
      <div class="text-xs text-gray-400">Tutorials & Admin Panel</div>
    </div>
  </div>

  <div class="flex items-center gap-4">
    <div id="adminToggle" class="flex items-center gap-2 cursor-pointer admin-badge" onclick="toggleAdminMode()">
      <i class="fas fa-user-shield text-red-400"></i>
      <span class="hidden sm:inline text-sm text-red-300">Admin Mode</span>
    </div>
    <button onclick="toggleMenu()" class="text-2xl hover:text-green-400 transition-colors p-2">☰</button>
  </div>
</header>

<!-- Menu Panel -->
<div id="menuPanel" class="hidden fixed top-16 right-4 w-64 z-50">
  <div class="bg-gray-800/95 backdrop-blur-md rounded-xl p-4 space-y-2 border border-gray-700 shadow-2xl">
    <a href="index.html" class="flex items-center p-3 rounded-lg hover:bg-gray-700/50 transition">
      <i class="fas fa-home w-6 mr-3 text-gray-400"></i>
      <span>Home</span>
    </a>
    <a href="grocery.html" class="flex items-center p-3 rounded-lg hover:bg-gray-700/50 transition">
      <i class="fas fa-shopping-cart w-6 mr-3 text-gray-400"></i>
      <span>Grocery List</span>
    </a>
    <a href="about.html" class="flex items-center p-3 rounded-lg hover:bg-gray-700/50 transition">
      <i class="fas fa-info-circle w-6 mr-3 text-gray-400"></i>
      <span>About Us</span>
    </a>
    <a href="terms.html" class="flex items-center p-3 rounded-lg hover:bg-gray-700/50 transition">
      <i class="fas fa-file-contract w-6 mr-3 text-gray-400"></i>
      <span>Terms & Conditions</span>
    </a>
    <a href="tutor.html" class="flex items-center p-3 rounded-lg bg-green-900/30 text-green-300 border border-green-800/30">
      <i class="fas fa-graduation-cap w-6 mr-3"></i>
      <span class="font-medium">Tutorials</span>
    </a>
  </div>
</div>

<main class="px-4 sm:px-6 pt-6 pb-20 max-w-6xl mx-auto">
  <!-- Admin Stats Panel (Only visible in admin mode) -->
  <div id="adminStatsPanel" class="hidden bg-gray-800/70 rounded-2xl p-6 border border-red-700/50 mb-8">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold text-red-300">
        <i class="fas fa-chart-line mr-2"></i>Admin Dashboard
      </h2>
      <div class="flex gap-2">
        <button onclick="refreshStats()" class="text-sm bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded-lg transition">
          <i class="fas fa-sync-alt mr-1"></i> Refresh
        </button>
        <button onclick="toggleAdminMode()" class="text-sm bg-red-700 hover:bg-red-600 px-3 py-1 rounded-lg transition">
          <i class="fas fa-times mr-1"></i> Exit Admin
        </button>
      </div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="bg-gray-900/70 p-4 rounded-xl">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-400 text-sm">Active Users</p>
            <p class="text-2xl font-bold" id="activeUsers">1,247</p>
          </div>
          <div class="w-12 h-12 rounded-full bg-green-900/30 flex items-center justify-center">
            <i class="fas fa-users text-green-400 text-xl"></i>
          </div>
        </div>
        <p class="text-xs text-gray-500 mt-2"><span class="text-green-400">+12%</span> from last month</p>
      </div>
      
      <div class="bg-gray-900/70 p-4 rounded-xl">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-400 text-sm">Lists Created</p>
            <p class="text-2xl font-bold" id="listsCreated">8,934</p>
          </div>
          <div class="w-12 h-12 rounded-full bg-blue-900/30 flex items-center justify-center">
            <i class="fas fa-list text-blue-400 text-xl"></i>
          </div>
        </div>
        <p class="text-xs text-gray-500 mt-2"><span class="text-green-400">+23%</span> from last month</p>
      </div>
      
      <div class="bg-gray-900/70 p-4 rounded-xl">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-400 text-sm">Video Views</p>
            <p class="text-2xl font-bold" id="videoViews">2,548</p>
          </div>
          <div class="w-12 h-12 rounded-full bg-purple-900/30 flex items-center justify-center">
            <i class="fas fa-play-circle text-purple-400 text-xl"></i>
          </div>
        </div>
        <p class="text-xs text-gray-500 mt-2"><span class="text-green-400">+45%</span> from last month</p>
      </div>
    </div>
    
    <div class="text-sm text-gray-400 italic">
      <i class="fas fa-info-circle mr-2"></i>Admin data refreshes automatically. Last updated: <span id="lastUpdated">Just now</span>
    </div>
  </div>

  <!-- Header Section -->
  <div class="mb-8 text-center">
    <h1 class="text-3xl font-bold mb-2"><u>BigTree Shopping Cart Tutorials</u></h1>
    <p class="text-gray-400">Learn how to use all features of the app with our step-by-step guides</p>
  </div>

  <!-- Tutorial Management Section (Admin) -->
  <div id="adminSection" class="bg-gray-800/50 rounded-2xl p-6 border border-gray-700 mb-8">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold text-green-300">
        <i class="fas fa-upload mr-2"></i>Upload New Tutorial
      </h2>
      <button onclick="toggleAdminSection()" class="text-sm bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded-lg transition">
        <i class="fas fa-cog mr-1"></i> Admin Panel
      </button>
    </div>
    
    <div id="uploadForm" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">
          <i class="fas fa-heading mr-2"></i>Tutorial Title
        </label>
        <input type="text" id="tutorialTitle" 
               class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
               placeholder="e.g., How to Create Your First Grocery List">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">
          <i class="fas fa-layer-group mr-2"></i>Module/Category
        </label>
        <select id="tutorialModule" 
                class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
          <option value="getting-started">Getting Started</option>
          <option value="grocery-list">Grocery List</option>
          <option value="voice-input">Voice Input</option>
          <option value="shopping-cart">Shopping Cart</option>
          <option value="printing">Printing & Export</option>
          <option value="advanced">Advanced Features</option>
          <option value="video">Video Tutorial</option>
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">
          <i class="fas fa-align-left mr-2"></i>Content (Step-by-Step Instructions)
        </label>
        <textarea id="tutorialContent" rows="4"
                  class="w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                  placeholder="Enter step-by-step instructions. Separate each step with a new line."></textarea>
        <p class="text-xs text-gray-500 mt-1">Tip: Start each step with a number or bullet point</p>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">
          <i class="fas fa-link mr-2"></i>YouTube Video URL
        </label>
        <div class="flex gap-2">
          <input type="url" id="tutorialVideoUrl" 
                 class="flex-1 bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"
                 placeholder="https://youtube.com/watch?v=... or https://youtu.be/...">
          <button onclick="testVideoUrl()" class="bg-blue-700 hover:bg-blue-600 text-white px-4 py-3 rounded-lg transition whitespace-nowrap">
            <i class="fas fa-play mr-2"></i>Test
          </button>
        </div>
        <p class="text-xs text-gray-500 mt-1">Paste a YouTube link. It will be embedded automatically.</p>
        
        <div id="videoPreview" class="mt-4 hidden">
          <div class="aspect-video bg-black rounded-lg mb-2 overflow-hidden">
            <iframe id="videoPreviewFrame" class="w-full h-full" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          </div>
          <p class="text-sm text-gray-400 text-center">Video preview - This is how it will appear on the page</p>
        </div>
      </div>
      
      <div class="flex gap-3">
        <button onclick="uploadTutorial()" 
                class="flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-semibold py-3 px-4 rounded-lg transition">
          <i class="fas fa-upload mr-2"></i>Upload Tutorial
        </button>
        <button onclick="clearForm()" 
                class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 px-4 rounded-lg transition">
          <i class="fas fa-times mr-2"></i>Clear Form
        </button>
      </div>
    </div>
  </div>

  <!-- Tutorial Modules Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
    <!-- Getting Started Module -->
    <div class="bg-gray-800/50 rounded-2xl p-6 border border-green-800/30 card-hover">
      <div class="flex items-center mb-4">
        <div class="w-12 h-12 rounded-lg bg-green-900/30 flex items-center justify-center mr-4">
          <i class="fas fa-rocket text-green-400 text-xl"></i>
        </div>
        <div>
          <h2 class="text-xl font-bold text-white">Getting Started</h2>
          <p class="text-sm text-gray-400">Beginner's guide</p>
        </div>
      </div>
      <p class="text-gray-300 mb-4">Learn the basics of BigTree Shopping Cart and how to navigate the interface.</p>
      <div id="getting-started-content" class="module-collapsed">
        <div class="space-y-4 pt-4 border-t border-gray-700">
          <!-- Tutorial steps will be loaded here -->
        </div>
      </div>
      <button onclick="toggleModule('getting-started')" 
              class="w-full mt-4 bg-green-900/30 hover:bg-green-900/40 text-green-300 font-medium py-2 px-4 rounded-lg transition flex items-center justify-center">
        <i class="fas fa-book-open mr-2"></i>
        <span>View Tutorial</span>
      </button>
    </div>
    
    <!-- Grocery List Module -->
    <div class="bg-gray-800/50 rounded-2xl p-6 border border-blue-800/30 card-hover">
      <div class="flex items-center mb-4">
        <div class="w-12 h-12 rounded-lg bg-blue-900/30 flex items-center justify-center mr-4">
          <i class="fas fa-shopping-cart text-blue-400 text-xl"></i>
        </div>
        <div>
          <h2 class="text-xl font-bold text-white">Grocery List</h2>
          <p class="text-sm text-gray-400">Shopping list management</p>
        </div>
      </div>
      <p class="text-gray-300 mb-4">Master the art of creating and managing perfect grocery lists.</p>
      <div id="grocery-list-content" class="module-collapsed">
        <div class="space-y-4 pt-4 border-t border-gray-700">
          <!-- Tutorial steps will be loaded here -->
        </div>
      </div>
      <button onclick="toggleModule('grocery-list')" 
              class="w-full mt-4 bg-blue-900/30 hover:bg-blue-900/40 text-blue-300 font-medium py-2 px-4 rounded-lg transition flex items-center justify-center">
        <i class="fas fa-book-open mr-2"></i>
        <span>View Tutorial</span>
      </button>
    </div>
    
    <!-- Voice Input Module -->
    <div class="bg-gray-800/50 rounded-2xl p-6 border border-purple-800/30 card-hover">
      <div class="flex items-center mb-4">
        <div class="w-12 h-12 rounded-lg bg-purple-900/30 flex items-center justify-center mr-4">
          <i class="fas fa-microphone text-purple-400 text-xl"></i>
        </div>
        <div>
          <h2 class="text-xl font-bold text-white">Voice Input</h2>
          <p class="text-sm text-gray-400">Hands-free adding</p>
        </div>
      </div>
      <p class="text-gray-300 mb-4">Learn how to use voice commands to add items quickly and efficiently.</p>
      <div id="voice-input-content" class="module-collapsed">
        <div class="space-y-4 pt-4 border-t border-gray-700">
          <!-- Tutorial steps will be loaded here -->
        </div>
      </div>
      <button onclick="toggleModule('voice-input')" 
              class="w-full mt-4 bg-purple-900/30 hover:bg-purple-900/40 text-purple-300 font-medium py-2 px-4 rounded-lg transition flex items-center justify-center">
        <i class="fas fa-book-open mr-2"></i>
        <span>View Tutorial</span>
      </button>
    </div>
    
    <!-- Shopping Cart Module -->
    <div class="bg-gray-800/50 rounded-2xl p-6 border border-yellow-800/30 card-hover">
      <div class="flex items-center mb-4">
        <div class="w-12 h-12 rounded-lg bg-yellow-900/30 flex items-center justify-center mr-4">
          <i class="fas fa-cart-plus text-yellow-400 text-xl"></i>
        </div>
        <div>
          <h2 class="text-xl font-bold text-white">Shopping Cart</h2>
          <p class="text-sm text-gray-400">Checkout & calculations</p>
        </div>
      </div>
      <p class="text-gray-300 mb-4">Understand how to use the shopping cart features for actual purchases.</p>
      <div id="shopping-cart-content" class="module-collapsed">
        <div class="space-y-4 pt-4 border-t border-gray-700">
          <!-- Tutorial steps will be loaded here -->
        </div>
      </div>
      <button onclick="toggleModule('shopping-cart')" 
              class="w-full mt-4 bg-yellow-900/30 hover:bg-yellow-900/40 text-yellow-300 font-medium py-2 px-4 rounded-lg transition flex items-center justify-center">
        <i class="fas fa-book-open mr-2"></i>
        <span>View Tutorial</span>
      </button>
    </div>
    
    <!-- Printing & Export Module -->
    <div class="bg-gray-800/50 rounded-2xl p-6 border border-red-800/30 card-hover">
      <div class="flex items-center mb-4">
        <div class="w-12 h-12 rounded-lg bg-red-900/30 flex items-center justify-center mr-4">
          <i class="fas fa-print text-red-400 text-xl"></i>
        </div>
        <div>
          <h2 class="text-xl font-bold text-white">Printing & Export</h2>
          <p class="text-sm text-gray-400">Save and share lists</p>
        </div>
      </div>
      <p class="text-gray-300 mb-4">Learn how to print, export, and save your shopping lists for later use.</p>
      <div id="printing-content" class="module-collapsed">
        <div class="space-y-4 pt-4 border-t border-gray-700">
          <!-- Tutorial steps will be loaded here -->
        </div>
      </div>
      <button onclick="toggleModule('printing')" 
              class="w-full mt-4 bg-red-900/30 hover:bg-red-900/40 text-red-300 font-medium py-2 px-4 rounded-lg transition flex items-center justify-center">
        <i class="fas fa-book-open mr-2"></i>
        <span>View Tutorial</span>
      </button>
    </div>
    
    <!-- Advanced Features Module -->
    <div class="bg-gray-800/50 rounded-2xl p-6 border border-cyan-800/30 card-hover">
      <div class="flex items-center mb-4">
        <div class="w-12 h-12 rounded-lg bg-cyan-900/30 flex items-center justify-center mr-4">
          <i class="fas fa-cogs text-cyan-400 text-xl"></i>
        </div>
        <div>
          <h2 class="text-xl font-bold text-white">Advanced Features</h2>
          <p class="text-sm text-gray-400">Pro tips & tricks</p>
        </div>
      </div>
      <p class="text-gray-300 mb-4">Discover advanced features to enhance your shopping experience.</p>
      <div id="advanced-content" class="module-collapsed">
        <div class="space-y-4 pt-4 border-t border-gray-700">
          <!-- Tutorial steps will be loaded here -->
        </div>
      </div>
      <button onclick="toggleModule('advanced')" 
              class="w-full mt-4 bg-cyan-900/30 hover:bg-cyan-900/40 text-cyan-300 font-medium py-2 px-4 rounded-lg transition flex items-center justify-center">
        <i class="fas fa-book-open mr-2"></i>
        <span>View Tutorial</span>
      </button>
    </div>
  </div>

  <!-- Video Tutorials Section -->
  <div class="bg-gray-800/50 rounded-2xl p-6 border border-gray-700 mb-8">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold text-green-300">
        <i class="fas fa-video mr-2"></i>Video Tutorials
      </h2>
      <button onclick="refreshVideos()" class="text-sm bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded-lg transition">
        <i class="fas fa-sync-alt mr-1"></i> Refresh
      </button>
    </div>
    <p class="text-gray-400 mb-6">Watch our video guides for visual learning</p>
    
    <div id="videoTutorialsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Videos will be loaded here dynamically -->
    </div>
    
    <div id="noVideosMessage" class="text-center py-10 text-gray-500">
      <i class="fas fa-video-slash text-4xl mb-4"></i>
      <p class="text-lg">No video tutorials available yet.</p>
      <p class="text-sm mt-2">Use the admin panel to upload video tutorials.</p>
    </div>
  </div>

  <!-- Help & Support Section -->
  <div class="bg-green-900/20 rounded-2xl p-6 border border-green-800/30">
    <div class="text-center">
      <i class="fas fa-question-circle text-4xl text-green-400 mb-4"></i>
      <h2 class="text-xl font-bold text-white mb-2">Need More Help?</h2>
      <p class="text-gray-400 mb-6">Can't find what you're looking for? We're here to help!</p>
      
      <div class="flex flex-wrap justify-center gap-4">
        <a href="mailto:stcrijohstudio@gmail.com" 
           class="bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white font-medium py-3 px-6 rounded-lg transition flex items-center">
          <i class="fas fa-envelope mr-2"></i> Email Support
        </a>
        <a href="about.html" 
           class="bg-gray-800 hover:bg-gray-700 text-white font-medium py-3 px-6 rounded-lg transition flex items-center">
          <i class="fas fa-info-circle mr-2"></i> Visit About Page
        </a>
      </div>
    </div>
  </div>
</main>

<script>
// ===============================
// GLOBAL STATE MANAGEMENT
// ===============================

// Admin password (in a real app, this would be handled server-side)
const ADMIN_PASSWORD = "bigtree2024";

// Initialize tutorials from localStorage or set defaults
let tutorials = JSON.parse(localStorage.getItem('bigtree_tutorials')) || {
  'getting-started': {
    title: 'Getting Started',
    steps: [
      'Open the BigTree Shopping Cart app in your browser',
      'Explore the main dashboard and familiar items',
      'Learn basic navigation using the menu button',
      'Set up your first shopping list'
    ],
    videoUrl: null
  },
  'grocery-list': {
    title: 'Grocery List',
    steps: [
      'Click "Grocery List" in the menu',
      'Add items by typing name and selecting category',
      'Use quick-add buttons for common items',
      'Organize items by food, clothes, or other categories'
    ],
    videoUrl: null
  },
  'voice-input': {
    title: 'Voice Input',
    steps: [
      'Look for the microphone icon',
      'Click and hold to start recording',
      'Speak clearly: "Add milk to food category"',
      'Review and confirm the transcribed item'
    ],
    videoUrl: null
  },
  'shopping-cart': {
    title: 'Shopping Cart',
    steps: [
      'Add items with prices to your cart',
      'View running total as you add items',
      'Apply discounts or promotions',
      'Calculate tax and final total'
    ],
    videoUrl: null
  },
  'printing': {
    title: 'Printing & Export',
    steps: [
      'Complete your grocery list',
      'Click "Print PDF" button',
      'Preview and adjust print settings',
      'Save as PDF or print directly'
    ],
    videoUrl: null
  },
  'advanced': {
    title: 'Advanced Features',
    steps: [
      'Create custom item presets',
      'Import/export lists from other apps',
      'Use keyboard shortcuts',
      'Set up recurring shopping lists'
    ],
    videoUrl: null
  }
};

// Video tutorials array
let videoTutorials = JSON.parse(localStorage.getItem('bigtree_video_tutorials')) || [];

// Admin stats (simulated)
let adminStats = {
  activeUsers: 1247,
  listsCreated: 8934,
  videoViews: 2548,
  lastUpdated: new Date().toLocaleTimeString()
};

// Track which modules are expanded
let expandedModules = {};

// Admin mode state
let adminMode = false;

// ===============================
// INITIALIZATION
// ===============================

document.addEventListener('DOMContentLoaded', function() {
  // Initialize tutorial modules
  Object.keys(tutorials).forEach(moduleId => {
    updateModuleContent(moduleId);
  });
  
  // Load video tutorials
  loadVideoTutorials();
  
  // Set up counter for tutorial steps
  document.querySelectorAll('.tutorial-step').forEach(step => {
    step.parentElement.style.counterReset = 'step';
  });
  
  // Check if admin mode is enabled from localStorage
  if (localStorage.getItem('bigtree_admin_mode') === 'true') {
    enableAdminMode();
  }
});

// ===============================
// ADMIN MODE FUNCTIONS
// ===============================

function toggleAdminMode() {
  if (!adminMode) {
    // Prompt for admin password
    const password = prompt('Enter admin password:');
    if (password === ADMIN_PASSWORD) {
      enableAdminMode();
      localStorage.setItem('bigtree_admin_mode', 'true');
    } else if (password !== null) {
      alert('Incorrect password');
    }
  } else {
    disableAdminMode();
    localStorage.removeItem('bigtree_admin_mode');
  }
}

function enableAdminMode() {
  adminMode = true;
  document.getElementById('adminStatsPanel').classList.remove('hidden');
  document.getElementById('adminToggle').classList.add('border', 'border-red-500', 'p-1', 'rounded-lg');
  showNotification('Admin mode enabled', 'red');
  
  // Update stats
  refreshStats();
}

function disableAdminMode() {
  adminMode = false;
  document.getElementById('adminStatsPanel').classList.add('hidden');
  document.getElementById('adminToggle').classList.remove('border', 'border-red-500', 'p-1', 'rounded-lg');
  showNotification('Admin mode disabled', 'gray');
}

function refreshStats() {
  // Simulate updating stats with random increments
  adminStats.activeUsers += Math.floor(Math.random() * 10) - 3;
  adminStats.listsCreated += Math.floor(Math.random() * 50);
  adminStats.videoViews += Math.floor(Math.random() * 20);
  adminStats.lastUpdated = new Date().toLocaleTimeString();
  
  // Update UI
  document.getElementById('activeUsers').textContent = adminStats.activeUsers.toLocaleString();
  document.getElementById('listsCreated').textContent = adminStats.listsCreated.toLocaleString();
  document.getElementById('videoViews').textContent = adminStats.videoViews.toLocaleString();
  document.getElementById('lastUpdated').textContent = adminStats.lastUpdated;
  
  showNotification('Stats updated', 'blue');
}

// ===============================
// TUTORIAL MANAGEMENT FUNCTIONS
// ===============================

function toggleModule(moduleId) {
  const content = document.getElementById(`${moduleId}-content`);
  const button = content.nextElementSibling;
  
  if (expandedModules[moduleId]) {
    content.classList.remove('module-expanded');
    content.classList.add('module-collapsed');
    button.innerHTML = '<i class="fas fa-book-open mr-2"></i><span>View Tutorial</span>';
  } else {
    content.classList.remove('module-collapsed');
    content.classList.add('module-expanded');
    button.innerHTML = '<i class="fas fa-times mr-2"></i><span>Close Tutorial</span>';
  }
  
  expandedModules[moduleId] = !expandedModules[moduleId];
}

function toggleAdminSection() {
  const form = document.getElementById('uploadForm');
  const adminSection = document.getElementById('adminSection');
  
  if (form.style.display === 'none') {
    form.style.display = 'block';
    adminSection.classList.add('border-green-500');
  } else {
    form.style.display = 'none';
    adminSection.classList.remove('border-green-500');
  }
}

function testVideoUrl() {
  const videoUrl = document.getElementById('tutorialVideoUrl').value;
  const videoPreview = document.getElementById('videoPreview');
  const videoPreviewFrame = document.getElementById('videoPreviewFrame');
  
  if (!videoUrl) {
    alert('Please enter a YouTube URL');
    return;
  }
  
  // Extract YouTube video ID
  const videoId = extractYouTubeId(videoUrl);
  
  if (!videoId) {
    alert('Invalid YouTube URL. Please use a valid YouTube link.');
    return;
  }
  
  // Build embed URL
  const embedUrl = `https://www.youtube.com/embed/${videoId}`;
  
  // Show preview
  videoPreviewFrame.src = embedUrl;
  videoPreview.classList.remove('hidden');
  
  showNotification('Video URL is valid. Preview loaded.', 'green');
}

function extractYouTubeId(url) {
  // Handle various YouTube URL formats
  const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
  const match = url.match(regExp);
  return (match && match[7].length === 11) ? match[7] : null;
}

function uploadTutorial() {
  if (!adminMode) {
    alert('Please enable admin mode first');
    return;
  }
  
  const title = document.getElementById('tutorialTitle').value;
  const module = document.getElementById('tutorialModule').value;
  const content = document.getElementById('tutorialContent').value;
  const videoUrl = document.getElementById('tutorialVideoUrl').value;
  
  if (!title) {
    alert('Please enter a tutorial title');
    return;
  }
  
  // Parse content into steps
  const steps = content.split('\n').filter(step => step.trim() !== '');
  
  if (module === 'video') {
    // Handle video tutorial upload
    if (!videoUrl) {
      alert('Please enter a YouTube URL for video tutorials');
      return;
    }
    
    const videoId = extractYouTubeId(videoUrl);
    if (!videoId) {
      alert('Invalid YouTube URL');
      return;
    }
    
    // Add to video tutorials
    const newVideo = {
      id: Date.now().toString(),
      title: title,
      description: content || 'No description provided',
      videoUrl: videoUrl,
      embedUrl: `https://www.youtube.com/embed/${videoId}`,
      thumbnail: `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`,
      date: new Date().toLocaleDateString(),
      views: 0
    };
    
    videoTutorials.unshift(newVideo); // Add to beginning
    localStorage.setItem('bigtree_video_tutorials', JSON.stringify(videoTutorials));
    
    // Update video display
    loadVideoTutorials();
    
    showNotification(`Video tutorial "${title}" uploaded successfully!`, 'green');
    
  } else {
    // Handle regular tutorial upload
    if (!steps.length && !videoUrl) {
      alert('Please enter tutorial content or a video URL');
      return;
    }
    
    // Update tutorial
    tutorials[module] = {
      title: title,
      steps: steps,
      videoUrl: videoUrl || null
    };
    
    // Save to localStorage
    localStorage.setItem('bigtree_tutorials', JSON.stringify(tutorials));
    
    // Update the displayed content
    updateModuleContent(module);
    
    showNotification(`Tutorial "${title}" uploaded to ${module.replace('-', ' ')} module!`, 'green');
  }
  
  // Clear form
  clearForm();
  document.getElementById('videoPreview').classList.add('hidden');
}

function updateModuleContent(moduleId) {
  const contentDiv = document.getElementById(`${moduleId}-content`);
  const tutorial = tutorials[moduleId];
  
  if (!contentDiv || !tutorial) return;
  
  let html = '<div class="space-y-4 pt-4 border-t border-gray-700">';
  
  // Add steps
  if (tutorial.steps && tutorial.steps.length) {
    tutorial.steps.forEach(step => {
      html += `<div class="tutorial-step text-gray-300">${step}</div>`;
    });
  }
  
  // Add video if exists
  if (tutorial.videoUrl) {
    const videoId = extractYouTubeId(tutorial.videoUrl);
    if (videoId) {
      html += `
        <div class="mt-6">
          <h4 class="font-medium text-white mb-2"><i class="fas fa-video mr-2"></i>Related Video</h4>
          <div class="aspect-video bg-black rounded-lg overflow-hidden">
            <iframe class="w-full h-full" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          </div>
        </div>
      `;
    }
  }
  
  html += '</div>';
  contentDiv.innerHTML = html;
  
  // Reset counter
  contentDiv.style.counterReset = 'step';
}

function loadVideoTutorials() {
  const container = document.getElementById('videoTutorialsContainer');
  const noVideosMessage = document.getElementById('noVideosMessage');
  
  if (!videoTutorials.length) {
    container.innerHTML = '';
    noVideosMessage.classList.remove('hidden');
    return;
  }
  
  noVideosMessage.classList.add('hidden');
  
  let html = '';
  videoTutorials.forEach(video => {
    html += `
      <div class="bg-gray-900/50 rounded-xl p-4 card-hover">
        <div class="aspect-video bg-black rounded-lg mb-4 overflow-hidden">
          <img src="${video.thumbnail}" alt="${video.title}" class="w-full h-full object-cover">
          <div class="relative -mt-10 flex justify-end px-4">
            <div class="bg-black/70 text-white text-xs px-2 py-1 rounded">
              <i class="fas fa-play mr-1"></i> Tutorial
            </div>
          </div>
        </div>
        <h3 class="font-bold text-white mb-2">${video.title}</h3>
        <p class="text-gray-400 text-sm mb-3">${video.description.substring(0, 80)}${video.description.length > 80 ? '...' : ''}</p>
        <div class="flex justify-between items-center">
          <button onclick="playVideo('${video.id}')" class="text-green-400 hover:text-green-300 text-sm flex items-center">
            <i class="fas fa-play mr-2"></i> Watch Now
          </button>
          <div class="text-xs text-gray-500">
            ${video.date} • ${video.views} views
            ${adminMode ? `<button onclick="deleteVideo('${video.id}')" class="ml-2 text-red-400 hover:text-red-300"><i class="fas fa-trash"></i></button>` : ''}
          </div>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

function refreshVideos() {
  loadVideoTutorials();
  showNotification('Video tutorials refreshed', 'blue');
}

function playVideo(videoId) {
  const video = videoTutorials.find(v => v.id === videoId);
  if (!video) return;
  
  // Increment view count
  video.views++;
  localStorage.setItem('bigtree_video_tutorials', JSON.stringify(videoTutorials));
  
  // Show video in modal
  const modalHtml = `
    <div id="videoModal" class="fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4">
      <div class="bg-gray-900 rounded-2xl max-w-4xl w-full overflow-hidden">
        <div class="flex justify-between items-center p-4 border-b border-gray-800">
          <h3 class="text-xl font-bold">${video.title}</h3>
          <button onclick="closeVideoModal()" class="text-2xl hover:text-red-400">&times;</button>
        </div>
        <div class="aspect-video">
          <iframe class="w-full h-full" src="${video.embedUrl}?autoplay=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        <div class="p-4">
          <p class="text-gray-300">${video.description}</p>
          <div class="mt-4 text-sm text-gray-500">
            <i class="fas fa-calendar mr-1"></i> ${video.date} • 
            <i class="fas fa-eye ml-4 mr-1"></i> ${video.views} views
          </div>
        </div>
      </div>
    </div>
  `;
  
  document.body.insertAdjacentHTML('beforeend', modalHtml);
}

function closeVideoModal() {
  const modal = document.getElementById('videoModal');
  if (modal) modal.remove();
}

function deleteVideo(videoId) {
  if (!adminMode) {
    alert('Admin mode required');
    return;
  }
  
  if (!confirm('Are you sure you want to delete this video tutorial?')) {
    return;
  }
  
  videoTutorials = videoTutorials.filter(video => video.id !== videoId);
  localStorage.setItem('bigtree_video_tutorials', JSON.stringify(videoTutorials));
  loadVideoTutorials();
  showNotification('Video tutorial deleted', 'red');
}

function clearForm() {
  document.getElementById('tutorialTitle').value = '';
  document.getElementById('tutorialContent').value = '';
  document.getElementById('tutorialVideoUrl').value = '';
  document.getElementById('videoPreview').classList.add('hidden');
}

// ===============================
// UI UTILITY FUNCTIONS
// ===============================

function showNotification(message, color = 'green') {
  const notification = document.createElement('div');
  notification.className = `fixed bottom-4 right-4 bg-${color}-600 text-white px-6 py-4 rounded-lg shadow-xl z-50 fade-in`;
  notification.style.animation = 'fadeIn 0.3s ease';
  notification.innerHTML = `
    <div class="flex items-center">
      <i class="fas fa-${color === 'green' ? 'check' : color === 'red' ? 'exclamation' : 'info'}-circle mr-3 text-xl"></i>
      <div>${message}</div>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.style.opacity = '0';
    notification.style.transition = 'opacity 0.3s';
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

// Menu toggle function - updated to handle scroll closing
function toggleMenu() {
  const menuPanel = document.getElementById('menuPanel');
  menuPanel.classList.toggle('hidden');
  
  // If opening the menu, add scroll listener
  if (!menuPanel.classList.contains('hidden')) {
    window.addEventListener('scroll', closeMenuOnScroll);
  } else {
    window.removeEventListener('scroll', closeMenuOnScroll);
  }
}

// Close menu when scrolling
function closeMenuOnScroll() {
  const menuPanel = document.getElementById('menuPanel');
  if (!menuPanel.classList.contains('hidden')) {
    menuPanel.classList.add('hidden');
    window.removeEventListener('scroll', closeMenuOnScroll);
  }
}

// Close menu when clicking outside - updated
document.addEventListener('click', function(event) {
  const menuPanel = document.getElementById('menuPanel');
  const menuButton = document.querySelector('button[onclick="toggleMenu()"]');
  
  if (!menuPanel.classList.contains('hidden') && 
      !menuPanel.contains(event.target) && 
      !menuButton.contains(event.target)) {
    menuPanel.classList.add('hidden');
    window.removeEventListener('scroll', closeMenuOnScroll);
  }
});

// Close menu when pressing Escape key - updated
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    const menuPanel = document.getElementById('menuPanel');
    if (!menuPanel.classList.contains('hidden')) {
      menuPanel.classList.add('hidden');
      window.removeEventListener('scroll', closeMenuOnScroll);
    }
  }
});

// Also close menu when clicking on any menu link
document.querySelectorAll('#menuPanel a').forEach(link => {
  link.addEventListener('click', function() {
    const menuPanel = document.getElementById('menuPanel');
    menuPanel.classList.add('hidden');
    window.removeEventListener('scroll', closeMenuOnScroll);
  });
});
</script>

</body>
</html>
